<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Manavta | Chat</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://i.imgur.com/nRy6k91.png" rel="icon">
    <meta name="description" content="Manavta is revolutionizing healthcare.">
    <meta name="keywords" content="manavta, healthcare, apratim, earthing, abhishek tk, swapnil">
    <meta name="author" content="Noxelle">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prefixfree/1.0.7/prefixfree.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js" type="text/javascript"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
    <link rel="stylesheet" href="{{ url_for('static',filename='css/style.css')}}">
    <link rel="stylesheet" href="{{ url_for('static',filename='css/stars.css')}}">
</head>

<body>
  <div id='stars'></div>
  <div id='stars2'></div>
  <div id='stars3'></div>

<section class="msger">
  <header class="msger-header">
    <div class="msger-header-title" style="font-weight: bolder;">
      <i class="fa fa-user-md"></i> 
      Manavta <div class="version">{{ version }}</div>
    </div>
    <div class="msger-header-options">
    </div>
  </header>

  <main class="msger-chat">
    <div class="msg right-msg">
    </div>
  </main>

  <form class="msger-inputarea">
    <a href=""><i class="fa fa-microphone" id="msger-mic"></i></a>
    <input type="text" class="msger-input" placeholder="Enter your message...">
    <input type="submit" class="msger-send-btn" value="Send" >
  </form>
</section>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.min.js"></script>
<script type="text/javascript">
  var socket = io.connect('http://' + document.domain + ':' + location.port);
  socket.on('connect', function() {
    socket.emit('user connect', {
      data: 'User Connected'
    } )
    var form = $( 'form' ).on( 'submit', function( e ) {
      e.preventDefault()
      let user_name = 'Test User'
      let user_input = $( 'input.msger-input' ).val()
      socket.emit( 'user response', {
        user_name : user_name,
        message : user_input
      } )
      $( 'input.msger-input' ).val( '' ).focus()
      $( 'input.username' ).hide()
    } )
  } )
  socket.on('user response', function( msg ) {
    var timestamp = Date().slice(16,21);
    if( typeof msg.user_name !== 'undefined' ) {
      $('main.msger-chat').append(`<div class="msg right-msg">
      <div
       class="msg-img"
       style="background-image: url({{ url_for('static',filename='img/user.png')}})"
      ></div>

      <div class="msg-bubble">
        <div class="msg-info">
          <div class="msg-info-name">${msg.user_name}</div>
          <div class="msg-info-time">${timestamp}</div>
        </div>

        <div class="msg-text" style="overflow-wrap: anywhere;">
          ${msg.message}
        </div>
      </div>
    </div>
    `)
    }
  })
  socket.on('bot response', function( msg ) {
    var timestamp = Date().slice(16,21);
    if( typeof msg.user_name !== 'undefined' ) {
      $('main.msger-chat').append(`<div class="msg left-msg">
      <div
       class="msg-img"
       style="background-image: url(https://i.imgur.com/dbSQ4ZF.png)"
      ></div>

      <div class="msg-bubble">
        <div class="msg-info">
          <div class="msg-info-name">Manav</div>
          <div class="msg-info-time">${timestamp}</div>
        </div>

        <div class="msg-text">
          ${msg.response}
        </div>
      </div>
    </div>
    `)
    }
  })
  socket.on('bot greet', function( msg ) {
    var timestamp = Date().slice(16,21);
    if( typeof msg.user_name !== 'undefined' ) {
      $('main.msger-chat').append(`<div class="msg left-msg">
      <div
       class="msg-img"
       style="background-image: url(https://i.imgur.com/dbSQ4ZF.png)"
      ></div>

      <div class="msg-bubble">
        <div class="msg-info">
          <div class="msg-info-name">Manav</div>
          <div class="msg-info-time">${timestamp}</div>
        </div>

        <div class="msg-text">
          ${msg.greet}
        </div>
      </div>
    </div>
    `)
    }
  })
</script>
<script src='https://use.fontawesome.com/releases/v5.0.13/js/all.js'></script>

</body>
</html>
